@model OperationCreateTourModel
@{
    ViewData["Title"] = "Operasyon Tur Düzenleme";

    // Bugüne en yakın Kur verisini al
    var closestKur = Model.KurList.OrderBy(k => Math.Abs((k.Tarih.ToDateTime(TimeOnly.MinValue) - DateTime.Today).TotalDays)).FirstOrDefault();

    // Kur değerlerini al
    decimal dolaraOran = closestKur?.DolaraOran ?? 0;
    decimal euroyaOran = closestKur?.EuroyaOran ?? 0;
    decimal kurUsd = 1 / dolaraOran;
    decimal kurEur = 1 / euroyaOran;
    kurUsd = Math.Round(kurUsd, 2);
    kurEur = Math.Round(kurEur, 2);
    Console.WriteLine(kurUsd);
    Console.WriteLine(kurEur);
}

<div id="addtourdiv">
    <!-- Tarih - Saat - Tur Tipi -->
    <div style ="padding-bottom:2em; display:flex; flex-direction:row">
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Tarih</p>
            <input type="date" id="Tarih" name="Tarih" placeholder="Tarih" />
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Saat</p>
            <input type="time" id="Saat" name="Saat" placeholder="Saat" />
        </div>
        <div>
            <p>Tur Tipi</p>
            <select id="TurTipiId" name="TurTipiId">
                <option value="">Seçenek seçin</option>
                @foreach (var tur in Model.TurTipiList)
                {
                    <option value="@tur.Id">@tur.TurTipiAdi</option>
                }
            </select>
        </div>
    </div>

    <!-- USD to TRY - EUR to TRY -->
    <div style="padding-bottom:2em; display:flex; flex-direction:row">
        <div style="padding-right:3em; display:flex; flex-direction:row">
            <p style="padding-right:1em;">1 USD =</p>
            <select id="UsdToTry" name="UsdToTry" disabled>
                <option value="@kurUsd">@kurUsd</option>
            </select>
            <p>TRY</p>
        </div>
        <div style="display:flex; flex-direction:row">
            <p style="padding-right:1em;">1 EUR =</p>
            <select id="EurToTry" name="EurToTry" disabled>
                <option value="@kurEur">@kurEur</option>
            </select>
            <p>TRY</p>
        </div>
    </div>

    <!-- Fiyat TRY - Fiyat USD - Fiyat EUR -->
    <div style="padding-bottom:2em; display:flex; flex-direction:row">
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Fiyat TRY</p>
            <input type="number" id="FiyatTry" name="FiyatTry" placeholder="FiyatTry" step="0.01" pattern="\d{1,16}(\.\d{2})?" />
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Fiyat USD</p>
            <input type="number" id="FiyatUsd" name="FiyatUsd" placeholder="FiyatUsd" step="0.01" pattern="\d{1,16}(\.\d{2})?" />
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Fiyat EUR</p>
            <input type="number" id="FiyatEur" name="FiyatEur" placeholder="FiyatEur" step="0.01" pattern="\d{1,16}(\.\d{2})?" />
        </div>
    </div>
    
    <!-- Arac 1 - Arac 2 - Arac 3 - Arac 4 -->
    <div style="padding-bottom:2em; display:flex; flex-direction:row">
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Arac 1</p>
            <select id="AracId1" name="AracId1">
                <option value="">Seçenek seçin</option>
                @foreach (var arac in Model.AracList.Where(a => a.AracTipiId == 1))
                {
                    var aracTipi = Model.AracTipiList.FirstOrDefault(a => a.Id == arac.AracTipiId);
                    <option value="@arac.Id">@($"{aracTipi.AracTipiAdi}, {arac.PlakaVeyaIsim}")</option>
                }
            </select>
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Arac 2</p>
            <select id="AracId2" name="AracId2">
                <option value="">Seçenek seçin</option>
                @foreach (var arac in Model.AracList.Where(a => a.AracTipiId == 1))
                {
                    var aracTipi = Model.AracTipiList.FirstOrDefault(a => a.Id == arac.AracTipiId);
                    <option value="@arac.Id">@($"{aracTipi.AracTipiAdi}, {arac.PlakaVeyaIsim}")</option>
                }
            </select>
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Arac 3</p>
            <select id="AracId3" name="AracId3">
                <option value="">Seçenek seçin</option>
                @foreach (var arac in Model.AracList.Where(a => a.AracTipiId == 1))
                {
                    var aracTipi = Model.AracTipiList.FirstOrDefault(a => a.Id == arac.AracTipiId);
                    <option value="@arac.Id">@($"{aracTipi.AracTipiAdi}, {arac.PlakaVeyaIsim}")</option>
                }
            </select>
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Arac 4</p>
            <select id="AracId4" name="AracId4">
                <option value="">Seçenek seçin</option>
                @foreach (var arac in Model.AracList.Where(a => a.AracTipiId == 1))
                {
                    var aracTipi = Model.AracTipiList.FirstOrDefault(a => a.Id == arac.AracTipiId);
                    <option value="@arac.Id">@($"{aracTipi.AracTipiAdi}, {arac.PlakaVeyaIsim}")</option>
                }
            </select>
        </div>
    </div>
    
    <!-- Servis 1 - Servis 2 - Servis 3 -->
    <div style="padding-bottom:2em; display:flex; flex-direction:row">
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Servis 1</p>
            <select id="ServisId1" name="ServisId1">
                <option value="">Seçenek seçin</option>
                @foreach (var arac in Model.AracList.Where(a => a.AracTipiId == 2))
                {
                    var aracTipi = Model.AracTipiList.FirstOrDefault(a => a.Id == arac.AracTipiId);
                    <option value="@arac.Id">@($"{aracTipi.AracTipiAdi}, {arac.PlakaVeyaIsim}")</option>
                }
            </select>
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Servis 2</p>
            <select id="ServisId2" name="ServisId2">
                <option value="">Seçenek seçin</option>
                @foreach (var arac in Model.AracList.Where(a => a.AracTipiId == 2))
                {
                    var aracTipi = Model.AracTipiList.FirstOrDefault(a => a.Id == arac.AracTipiId);
                    <option value="@arac.Id">@($"{aracTipi.AracTipiAdi}, {arac.PlakaVeyaIsim}")</option>
                }
            </select>
        </div>
        <div style="padding-right:1em; display:flex; flex-direction:column">
            <p>Servis 3</p>
            <select id="ServisId3" name="ServisId3">
                <option value="">Seçenek seçin</option>
                @foreach (var arac in Model.AracList.Where(a => a.AracTipiId == 2))
                {
                    var aracTipi = Model.AracTipiList.FirstOrDefault(a => a.Id == arac.AracTipiId);
                    <option value="@arac.Id">@($"{aracTipi.AracTipiAdi}, {arac.PlakaVeyaIsim}")</option>
                }
            </select>
        </div>
    </div>

    <button type="button" onclick="createTour()">Tur Oluştur</button>
</div>

<script>
    function createTour() {
        var tarih = document.getElementById("Tarih").value;
        var saat = document.getElementById("Saat").value;
        var turTipiId = document.getElementById("TurTipiId").value;
        var fiyatTry = document.getElementById("FiyatTry").value;
        var fiyatUsd = document.getElementById("FiyatUsd").value;
        var fiyatEur = document.getElementById("FiyatEur").value;
        var aracId1 = document.getElementById("AracId1").value;
        var aracId2 = document.getElementById("AracId2").value;
        var aracId3 = document.getElementById("AracId3").value;
        var aracId4 = document.getElementById("AracId4").value;
        var servisId1 = document.getElementById("ServisId1").value;
        var servisId2 = document.getElementById("ServisId2").value;
        var servisId3 = document.getElementById("ServisId3").value;

        

        // Check if certain values are null
        if (tarih && saat && turTipiId && fiyatTry && fiyatUsd && fiyatEur && aracId1) {
            
            var tourValues = [];
            tourValues.push(tarih);
            tourValues.push(saat);
            tourValues.push(turTipiId);
            tourValues.push(fiyatTry);
            tourValues.push(fiyatUsd);
            tourValues.push(fiyatEur);
            tourValues.push(aracId1);
            tourValues.push(aracId2);
            tourValues.push(aracId3);
            tourValues.push(aracId4);
            tourValues.push(servisId1);
            tourValues.push(servisId2);
            tourValues.push(servisId3);

            console.log(tourValues);

            sendArrayToController(tourValues);
            
        } else {
            alert("Please fill in all the required fields.");
        }
    }

    function sendArrayToController(array) {
        $.ajax({
            type: "POST",
            url: "/Home/SendTourDetails", // URL of the controller action
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(array),
            success: function (response) {
                console.log("Data sent successfully:", response);
                if (response.redirectUrl) {
                    window.location.href = response.redirectUrl;
                }
            },
            error: function (error) {
                console.error("Error sending data:", error);
            }
        });
    }
</script>